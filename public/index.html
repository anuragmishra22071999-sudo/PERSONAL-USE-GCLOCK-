<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>ANURAG BOT - Panel</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#0f1720;color:#e6eef8;padding:18px}
    .box{max-width:980px;margin:8px auto;background:#0b1220;padding:18px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,.6)}
    textarea{width:100%;height:160px;background:#08101a;color:#dfefff;padding:10px;border-radius:6px;border:1px solid #123}
    input,button{padding:10px;border-radius:6px;border:0}
    button{background:#1f6feb;color:white;margin-left:6px}
    #logs{height:320px;overflow:auto;background:#06111a;padding:10px;border-radius:6px;border:1px solid #123;white-space:pre-wrap}
    label{display:block;margin:8px 0 6px}
  </style>
</head>
<body>
  <div class="box">
    <h2>ðŸ‘‘ ANURAG BOT - Panel</h2>
    <label>Admin UID</label>
    <input id="uid" placeholder="Enter admin UID" />
    <label>Paste appstate.json</label>
    <textarea id="appstate" placeholder='Paste appstate JSON here'></textarea>
    <div style="margin-top:8px">
      <button onclick="startBot()">ðŸš€ Start Bot</button>
      <button onclick="stopBot()">ðŸ›‘ Stop Bot</button>
      <button onclick="refreshLogs()">ðŸ“œ Fetch Logs</button>
    </div>
    <h3 style="margin-top:14px">Live Logs</h3>
    <div id="logs">(no logs)</div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    let currentUID = null;

    socket.on("connect", () => {
      appendLog("[socket] connected");
      if (currentUID) socket.emit("join", currentUID);
    });

    socket.on("botlog", (m) => appendLog(m));

    function appendLog(m) {
      const box = document.getElementById("logs");
      box.innerText += m + "\n";
      box.scrollTop = box.scrollHeight;
    }

    async function startBot() {
      const uid = document.getElementById("uid").value.trim();
      const appstate = document.getElementById("appstate").value.trim();
      if (!uid || !appstate) return alert("Provide UID and appstate");
      currentUID = uid;
      socket.emit("join", uid);
      try {
        const res = await fetch("/start-bot", {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({ admin: uid, appstate })
        });
        const text = await res.text();
        alert(text);
      } catch (e) {
        alert("Start failed: " + e.message);
      }
    }

    async function stopBot() {
      const uid = document.getElementById("uid").value.trim();
      if (!uid) return alert("Enter UID");
      try {
        const res = await fetch("/stop-bot?uid=" + encodeURIComponent(uid));
        const text = await res.text();
        alert(text);
      } catch (e) {
        alert("Stop failed: " + e.message);
      }
    }

    async function refreshLogs() {
      const uid = document.getElementById("uid").value.trim();
      if (!uid) return alert("Enter UID");
      const res = await fetch("/logs?uid=" + encodeURIComponent(uid));
      const text = await res.text();
      document.getElementById("logs").innerText = text;
    }
  </script>
</body>
</html>
